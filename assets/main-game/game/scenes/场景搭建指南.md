# 主游戏场景搭建指南

## 概述
本文档详细说明如何在 Cocos Creator 编辑器中搭建 MainGame 主游戏场景。

## 场景结构

```
MainGame (场景)
├── Canvas (Canvas 根节点)
│   ├── Camera (主摄像机 + CameraFollow 组件)
│   ├── GameManager (空节点 + GameManager 组件)
│   ├── Background (背景容器)
│   │   ├── GroundLayer (地面背景)
│   │   ├── CityLayer (城市背景)
│   │   ├── SkyLayer (天空背景)
│   │   └── SpaceLayer (太空背景)
│   ├── BlockContainer (建筑块容器 + BlockController 组件)
│   └── UI (UI 容器 + GameUI 组件)
│       ├── GameUI (游戏中界面)
│       │   ├── TopBar (顶部信息栏)
│       │   │   ├── ScoreLabel (分数显示)
│       │   │   ├── HeightLabel (高度显示)
│       │   │   └── PauseButton (暂停按钮)
│       │   └── ComboNode (连击提示)
│       │       └── ComboLabel (连击文字)
│       ├── StartPanel (开始界面)
│       │   ├── TitleLabel (游戏标题)
│       │   ├── StartButton (开始按钮)
│       │   └── BestScoreLabel (最佳成绩)
│       ├── PausePanel (暂停界面)
│       │   ├── PauseTitle (暂停标题)
│       │   ├── ResumeButton (继续按钮)
│       │   └── RestartButton (重新开始按钮)
│       └── GameOverPanel (游戏结束界面)
│           ├── GameOverTitle (结束标题)
│           ├── FinalScoreLabel (最终分数)
│           ├── FinalHeightLabel (最终高度)
│           ├── HighScoreLabel (最高分)
│           └── PlayAgainButton (再玩一次按钮)
```

## 详细搭建步骤

### 1. 创建场景基础结构

#### 1.1 Canvas 设置
1. 打开 Cocos Creator，打开或创建 `MainGame.scene`
2. 选中 Canvas 节点，设置属性：
   - **UITransform**: 
     - Content Size: `720 x 1200` (手机竖屏尺寸)
   - **Canvas**: 
     - Align Canvas With Screen: ✓ 勾选
   - **Widget**: 
     - 勾选所有对齐方式，确保全屏显示

#### 1.2 Camera 设置
1. 选中 Canvas 下的 Camera 节点
2. 设置 Camera 组件属性：
   - **Projection**: Ortho (正交投影)
   - **Ortho Height**: 600
   - **Near**: 1
   - **Far**: 2000
   - **Clear Flags**: Solid Color
   - **Background Color**: `#334C78` (深蓝色)
3. **添加 CameraFollow 组件**：
   - 点击 "Add Component" 按钮
   - 搜索 "CameraFollow"
   - 添加组件
   - 设置参数：
     - Follow Speed: `5`
     - Smooth Time: `0.3`
     - Offset Y: `200`
     - Min Height: `0`
     - Max Height: `10000`

### 2. 创建 GameManager 节点

1. 在 Canvas 下创建空节点，命名为 `GameManager`
2. **添加 GameManager 组件**：
   - 点击 "Add Component"
   - 搜索 "GameManager"
   - 添加组件
3. 设置 GameManager 组件属性（稍后关联引用）：
   - Block Container: `待关联`
   - Background Node: `待关联`
   - UI Node: `待关联`
   - Camera Node: `待关联 Camera`
   - Block Prefab: `待创建`
   - Initial Block Speed: `100`
   - Speed Increment: `5`
   - Perfect Align Threshold: `5`
   - Perfect Align Bonus: `50`
   - Normal Align Score: `10`
   - Combo Multiplier: `2`

### 3. 创建背景系统

#### 3.1 创建 Background 容器
1. 在 Canvas 下创建空节点，命名为 `Background`
2. 设置位置：
   - Position: `(0, 0, -10)` (在游戏内容后面)
3. **添加 BackgroundController 组件**

#### 3.2 创建背景层
为每个背景层创建 Sprite 节点：

**GroundLayer (地面层)**：
1. 创建 Sprite 节点，命名为 `GroundLayer`
2. 设置 Sprite 组件：
   - Sprite Frame: 选择地面背景图片
   - Size Mode: CUSTOM
   - Content Size: `720 x 1200`
3. 设置位置: `(0, 0, 0)`

**CityLayer (城市层)**：
1. 创建 Sprite 节点，命名为 `CityLayer`
2. 设置 Sprite 组件：
   - Sprite Frame: 选择城市背景图片
   - Size Mode: CUSTOM
   - Content Size: `720 x 1200`
3. 设置位置: `(0, 0, 0)`
4. 默认隐藏：取消勾选 Active

**SkyLayer (天空层)**：
1. 创建 Sprite 节点，命名为 `SkyLayer`
2. 设置 Sprite 组件：
   - Sprite Frame: 选择天空背景图片
   - Size Mode: CUSTOM
   - Content Size: `720 x 1200`
3. 设置位置: `(0, 0, 0)`
4. 默认隐藏：取消勾选 Active

**SpaceLayer (太空层)**：
1. 创建 Sprite 节点，命名为 `SpaceLayer`
2. 设置 Sprite 组件：
   - Sprite Frame: 选择太空背景图片
   - Size Mode: CUSTOM
   - Content Size: `720 x 1200`
3. 设置位置: `(0, 0, 0)`
4. 默认隐藏：取消勾选 Active

#### 3.3 配置 BackgroundController
选中 Background 节点，设置 BackgroundController 组件：
- Ground Layer: 拖拽 `GroundLayer` 节点
- City Layer: 拖拽 `CityLayer` 节点
- Sky Layer: 拖拽 `SkyLayer` 节点
- Space Layer: 拖拽 `SpaceLayer` 节点
- Ground Threshold: `0`
- City Threshold: `500`
- Sky Threshold: `1500`
- Space Threshold: `3000`

### 4. 创建建筑块容器

1. 在 Canvas 下创建空节点，命名为 `BlockContainer`
2. 设置位置：
   - Position: `(0, -400, 0)` (从屏幕下方开始)
3. **添加 BlockController 组件**：
   - Block Prefab: `待创建`
   - Block Width: `200`
   - Block Height: `50`
   - Move Range: `300`
   - Default Speed: `100`

### 5. 创建 UI 系统

#### 5.1 创建 UI 根节点
1. 在 Canvas 下创建空节点，命名为 `UI`
2. 添加 UITransform 组件：
   - Content Size: `720 x 1200`
3. **添加 GameUI 组件**

#### 5.2 创建游戏中 UI (GameUI)

**TopBar (顶部信息栏)**：
1. 创建空节点 `TopBar`
2. 设置位置：`(0, 550, 0)`

**ScoreLabel (分数显示)**：
1. 在 TopBar 下创建 Label 节点，命名为 `ScoreLabel`
2. 设置位置：`(-100, 0, 0)`
3. 设置 Label 属性：
   - String: "0"
   - Font Size: `48`
   - Color: 白色
   - Horizontal Align: LEFT

**HeightLabel (高度显示)**：
1. 在 TopBar 下创建 Label 节点，命名为 `HeightLabel`
2. 设置位置：`(100, 0, 0)`
3. 设置 Label 属性：
   - String: "0m"
   - Font Size: `36`
   - Color: 白色
   - Horizontal Align: RIGHT

**PauseButton (暂停按钮)**：
1. 在 TopBar 下创建 Button 节点，命名为 `PauseButton`
2. 设置位置：`(300, 0, 0)`
3. 设置 Button 和 Sprite 属性
4. 添加 Label 子节点，显示 "暂停" 或图标

**ComboNode (连击提示)**：
1. 在 GameUI 下创建空节点，命名为 `ComboNode`
2. 设置位置：`(0, 200, 0)`
3. 默认隐藏：取消勾选 Active

**ComboLabel**：
1. 在 ComboNode 下创建 Label 节点
2. 设置 Label 属性：
   - String: "连击 x2"
   - Font Size: `64`
   - Color: 金色 `#FFD700`
   - Horizontal Align: CENTER

#### 5.3 创建开始界面 (StartPanel)

1. 在 UI 下创建空节点，命名为 `StartPanel`
2. 添加 Sprite 组件作为背景（半透明黑色）

**TitleLabel (游戏标题)**：
1. 创建 Label 节点
2. 设置位置：`(0, 300, 0)`
3. 设置属性：
   - String: "摩天叠叠乐"
   - Font Size: `72`
   - Color: 白色

**StartButton (开始按钮)**：
1. 创建 Button 节点
2. 设置位置：`(0, 0, 0)`
3. 设置大小：`200 x 80`
4. 添加 Label 子节点：文字 "开始游戏"

**BestScoreLabel (最佳成绩)**：
1. 创建 Label 节点
2. 设置位置：`(0, -200, 0)`
3. 设置属性：
   - String: "最高分: 0"
   - Font Size: `36`

#### 5.4 创建暂停界面 (PausePanel)

1. 在 UI 下创建空节点，命名为 `PausePanel`
2. 添加 Sprite 组件作为背景（半透明黑色）
3. 默认隐藏：取消勾选 Active

**PauseTitle**：
1. 创建 Label 节点
2. 设置位置：`(0, 200, 0)`
3. 文字："游戏暂停"

**ResumeButton (继续按钮)**：
1. 创建 Button 节点
2. 设置位置：`(0, 50, 0)`
3. Label 文字："继续"

**RestartButton (重新开始按钮)**：
1. 创建 Button 节点
2. 设置位置：`(0, -50, 0)`
3. Label 文字："重新开始"

#### 5.5 创建游戏结束界面 (GameOverPanel)

1. 在 UI 下创建空节点，命名为 `GameOverPanel`
2. 添加 Sprite 组件作为背景（半透明黑色）
3. 默认隐藏：取消勾选 Active

**GameOverTitle**：
1. 创建 Label 节点
2. 设置位置：`(0, 300, 0)`
3. 文字："游戏结束"
4. Font Size: `64`

**FinalScoreLabel**：
1. 创建 Label 节点
2. 设置位置：`(0, 150, 0)`
3. 文字："分数: 0"

**FinalHeightLabel**：
1. 创建 Label 节点
2. 设置位置：`(0, 100, 0)`
3. 文字："高度: 0m"

**HighScoreLabel**：
1. 创建 Label 节点
2. 设置位置：`(0, 50, 0)`
3. 文字："最高分: 0"

**PlayAgainButton**：
1. 创建 Button 节点
2. 设置位置：`(0, -100, 0)`
3. Label 文字："再玩一次"

#### 5.6 配置 GameUI 组件

选中 UI 节点，在 GameUI 组件中关联所有引用：

**游戏中 UI**：
- Score Label: 拖拽 `ScoreLabel`
- Height Label: 拖拽 `HeightLabel`
- Combo Label: 拖拽 `ComboLabel`
- Combo Node: 拖拽 `ComboNode`
- Pause Button: 拖拽 `PauseButton`

**开始界面**：
- Start Panel: 拖拽 `StartPanel`
- Start Button: 拖拽 `StartButton`
- Title Label: 拖拽 `TitleLabel`

**暂停界面**：
- Pause Panel: 拖拽 `PausePanel`
- Resume Button: 拖拽 `ResumeButton`
- Restart Button: 拖拽 `RestartButton`

**游戏结束界面**：
- Game Over Panel: 拖拽 `GameOverPanel`
- Final Score Label: 拖拽 `FinalScoreLabel`
- Final Height Label: 拖拽 `FinalHeightLabel`
- High Score Label: 拖拽 `HighScoreLabel`
- Play Again Button: 拖拽 `PlayAgainButton`

### 6. 关联 GameManager 引用

选中 GameManager 节点，在 GameManager 组件中关联所有引用：
- Block Container: 拖拽 `BlockContainer` 节点
- Background Node: 拖拽 `Background` 节点
- UI Node: 拖拽 `UI` 节点
- Camera Node: 拖拽 `Camera` 节点
- Block Prefab: 拖拽建筑块预制体（需要先创建）

### 7. 创建建筑块预制体

#### 7.1 创建 Block 预制体
1. 在项目资源面板中，进入 `assets/main-game/game/prefabs/` 目录
2. 右键 → 创建 → Prefab
3. 命名为 `Block`

#### 7.2 编辑 Block 预制体
1. 双击打开 Block 预制体
2. 创建 Sprite 节点作为根节点
3. 设置 Sprite 属性：
   - Content Size: `200 x 50`
   - Color: 随机颜色（或使用纯色）
4. **添加 Block 组件**：
   - Move Speed: `100`
   - Move Range: `300`
5. 添加 UITransform 组件：
   - Content Size: `200 x 50`
6. 保存预制体

### 8. 最终检查

#### 8.1 确认组件关联
- [ ] GameManager 的所有引用都已关联
- [ ] GameUI 的所有 Label 和 Button 都已关联
- [ ] BackgroundController 的所有背景层都已关联
- [ ] BlockController 的 Block Prefab 已关联

#### 8.2 确认层级设置
- [ ] Camera 在正确的 Z 轴位置
- [ ] Background 在游戏内容后面 (Z = -10)
- [ ] BlockContainer 在游戏内容层 (Z = 0)
- [ ] UI 在最前面 (Z = 10)

#### 8.3 确认初始状态
- [ ] StartPanel 默认显示
- [ ] PausePanel 默认隐藏
- [ ] GameOverPanel 默认隐藏
- [ ] ComboNode 默认隐藏
- [ ] 除 GroundLayer 外的背景层默认隐藏

## 场景配置完成

搭建完成后，保存场景，就可以在 Cocos Creator 中运行测试了。

## 下一步

1. 创建更多的建筑块样式（不同颜色、纹理）
2. 准备背景图片资源（地面、城市、天空、太空）
3. 添加音效和音乐
4. 实现建筑块的物理效果和掉落动画
5. 优化 UI 视觉效果
6. 添加粒子特效（完美对齐时的特效）

## 调试建议

1. 运行场景，检查是否有控制台错误
2. 测试点击屏幕是否能触发游戏开始
3. 检查 Camera 是否能正确跟随
4. 测试所有 UI 面板的显示和隐藏
5. 测试按钮点击事件是否正常

## 常见问题

### Q: 场景运行时报错 "无法找到组件"
A: 检查脚本文件是否正确保存，并确保 Cocos Creator 已刷新资源。

### Q: UI 显示不正确
A: 检查 Canvas 的 Widget 组件是否正确设置，确保所有对齐选项都已勾选。

### Q: 摄像机跟随不生效
A: 确保 CameraFollow 组件已正确添加到 Camera 节点，并且 GameManager 在运行时调用了相关方法。

### Q: 背景切换不生效
A: 检查 BackgroundController 的背景层引用是否正确关联。

---

**注意**: 本指南基于 Cocos Creator 3.8.7 版本编写。不同版本的编辑器界面可能略有差异。

